<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <title>迷宫生成器</title>
    <style>
      .maze-container {
        display: inline-block;
        margin: 10px;
      }
      .row {
        height: 20px;
      }
      .cell {
        width: 20px;
        height: 20px;
        display: inline-block;
        border: 1px solid #000;
      }
      .wall {
        background-color: #000;
      }
      .path {
        background-color: #fff;
      }
      .res {
        background-color: yellow;
      }
      .start {
        background-color: green; /* 起点为绿色 */
      }
      .end {
        background-color: red; /* 终点为红色 */
      }
    </style>
  </head>
  <body>
    <div id="maze"></div>
    <pre id="mazeData"></pre>
    <!-- 显示迷宫数据 -->

    <script>
      const mazeContainer = document.getElementById("maze");
      const mazeDataElement = document.getElementById("mazeData");
      const mazeRows = 21; // 将行数和列数减少以确保四周只有一层墙
      const mazeColumns = 21;

      const maze = [];
      for (let i = 0; i < mazeRows; i++) {
        maze[i] = [];
        for (let j = 0; j < mazeColumns; j++) {
          maze[i][j] = 0; // 初始化为墙壁
        }
      }

      function generateMaze(x, y) {
        const directions = [
          [1, 0],
          [-1, 0],
          [0, 1],
          [0, -1],
        ];

        directions.sort(() => Math.random() - 0.5);

        for (let i = 0; i < directions.length; i++) {
          const dx = directions[i][0];
          const dy = directions[i][1];
          const nx = x + 2 * dx;
          const ny = y + 2 * dy;

          if (nx > 0 && nx < mazeRows - 1 && ny > 0 && ny < mazeColumns - 1 && maze[nx][ny] === 0) {
            maze[x + dx][y + dy] = 1; // 路径
            maze[nx][ny] = 1; // 路径
            generateMaze(nx, ny);
          }
        }
      }

      // 从坐标 (1, 1) 开始生成迷宫
      generateMaze(1, 1);

      const findAllPaths = (maze, start, end) => {
        const rows = maze.length;
        const cols = maze[0].length;
        const directions = [
          [-1, 0],
          [1, 0],
          [0, -1],
          [0, 1],
        ];
        const paths = [];

        function dfs(current, path) {
          if (current[0] === end[0] && current[1] === end[1]) {
            paths.push([...path]);
            return;
          }

          for (const direction of directions) {
            const newRow = current[0] + direction[0];
            const newCol = current[1] + direction[1];
            const newPosition = [newRow, newCol];

            if (newRow >= 0 && newRow < rows && newCol >= 0 && newCol < cols && maze[newRow][newCol] === 1 && !path.some((p) => p[0] === newRow && p[1] === newCol)) {
              path.push(newPosition);
              dfs(newPosition, path);
              path.pop();
            }
          }
        }

        dfs(start, [start]);
        return paths;
      };

      const result = findAllPaths(maze, [1, 1], [19, 19]);
      let index = 0,
        min = result[0].length;
      for (let i = 0; i < result.length; i++) {
        if (result[i].length < min) {
          min = result[i].length;
          index = i;
        }
      }
      for (let i = 0; i < result[index].length; i++) {
        maze[result[index][i][0]][result[index][i][1]] = 2;
      }

      for (let i = 0; i < mazeRows; i++) {
        const row = document.createElement("div");
        row.className = "row";
        mazeContainer.appendChild(row);
        const rowElements = document.getElementsByClassName("row");
        const rowElement = rowElements[rowElements.length - 1];
        for (let j = 0; j < mazeColumns; j++) {
          const cell = document.createElement("div");
          if (maze[i][j] === 0) {
            cell.className = "cell wall";
          } else if (maze[i][j] === 1) {
            cell.className = "cell path";
          } else {
            cell.className = "cell res";
          }
          // cell.className = "cell " + (maze[i][j] === 1 ? "path" : "wall");

          // 标记起点
          if (i === 1 && j === 1) {
            cell.classList.add("start");
          }

          // 标记终点（例如右下角前一格）
          if (i === mazeRows - 2 && j === mazeColumns - 2) {
            cell.classList.add("end");
          }

          rowElement.appendChild(cell);
        }
        // mazeContainer.appendChild(document.createElement("br"));
      }
    </script>
  </body>
</html>
